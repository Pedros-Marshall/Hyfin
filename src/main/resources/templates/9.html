<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Template 09</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;500;700&family=Readex+Pro:wght@300;400;500;600&display=swap"
          rel="stylesheet">
    <!-- Link Swiper's CSS -->
    <link rel="stylesheet" href="./assets/lib/swiper/swiper-bundle.min.css"/>
    <!-- Link Main CSS -->
    <link rel="stylesheet" href="./assets/css/style.css?ver=1.1">
</head>
<body class="hf-bg-solid">
<div class="hf-wrap">
    <!-- Header Start -->
    <header class="hf-header">
        <div class="hf-logo-wrap">
            <div class="hf-logo">
                <img src="./assets/images/hyfin-logo.svg" alt="">
            </div>
            <div class="hf-current-screen">
                <span class="hf-current-screen-title">FX CFD Video</span>
            </div>
        </div>
        <div class="hf-main-menu-wrap">
            <ul class="hf-main-menu">
                <li class="hf-menu-item hf-menu-item-courses hf-menu-item-current"><a href="1.html">Courses</a></li>
                <li class="hf-menu-item hf-menu-item-help"><a href="faqs.html">FAQs</a></li>
                <li class="hf-menu-item hf-menu-item-glossary"><a href="glossary.html">Glossary</a></li>
            </ul>
            <div class="hf-header-icons">
                <a class="hf-hicon-search" href="search.html"><img src="./assets/images/icon-search.svg" alt=""></a>
                <a class="hf-hicon-profile" href="account.html"><img src="./assets/images/icon-profile.svg" alt=""></a>
                <div class="hf-hicon-menu">
                    <div class="hf-menu-btn" id="hf-menu-trigger">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- Header End -->
    <main class="hf-main">
        <div class="hf-main-inner">
            <div hidden id="expired" class="hf-myacc-wrap hf-frame">
                <!-- My account form Wrap Start -->
                <div class="hf-myacc">
                    <!-- My account Form Start -->
                    <div class="hf-form hf-myacc-form">
                        <div class="hf-form-inner">
                            <header class="hf-form-header" style="justify-content: center; display: flex;">
                                <div style="margin-top: 100px" class="hf-form-header-text">
                                    <h3 class="hf-form-title" style="text-align: left">Your session is expired. Reload
                                        page to try again</h3>
                                </div>
                                <a onclick="reload()" href="#">
                                    <div style="height: 128px; width: 128px; margin-top: 20px; background-size: cover; background-image: url('./assets/images/refresh.png')"
                                         class="hf-form-header-text">
                                    </div>
                                </a>
                            </header>
                        </div>
                    </div>
                    <!-- My account Form End -->
                </div>
                <!-- My account form Wrap End -->

                <!-- frames start -->
                <span class="hf-frame-tl"></span>
                <span class="hf-frame-tr"></span>
                <span class="hf-frame-bl"></span>
                <span class="hf-frame-br"></span>
                <!-- frames end -->
            </div>
            <!-- Video Wrap Start -->
            <div id="video" class="hf-video-wrap">
                <!-- Video Start -->
                <div class="hf-video">
                    <div class="hf-video-inner">
                        <!-- Video embed code  -->
                        <div style="padding:55.66% 0 0 0;position:relative;">
                            <iframe th:src="@{${'https://player.vimeo.com/video/' + vimeoId + '&color=ff9933&title=0&byline=0&portrait=0'}}" style="position:absolute;top:0;left:0;width:100%;height:100%;" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>
                        </div>
                        <script src="https://player.vimeo.com/api/player.js"></script>
                        <!-- Video embed code  -->
                    </div>
                </div>
                <!-- Video End -->
                <!-- Video frames start -->
                <span class="hf-video-frame-tl"></span>
                <span class="hf-video-frame-tr"></span>
                <span class="hf-video-frame-bl"></span>
                <span class="hf-video-frame-br"></span>
                <!-- Video frames end -->
            </div>
            <!-- Video Wrap End -->
            <!-- Done Button Start -->
            <form class="hf-form hf-done-form" id="done-form" role="form" th:action="@{/video/complete}" method="GET">
                <div class="hf-video-button-wrap">
                    <button id="dis-button" disabled class="hf-button disabled-button"><span>Done</span></button>
                </div>
            </form>
            <!-- Done Button End -->
        </div>
    </main>
    <!-- Footer Start -->
    <footer class="hf-footer">
        <div class="hf-footer-inner">
            <p class="hp-copy">Copyright Â© 2023 Hyfin. All Rights Reserved</p>
        </div>
    </footer>
    <!-- Footer End -->
    <!-- Left Panel Start -->
    <div class="hf-left-menu-wrap">
        <button class="hf-lm-close">
            <a th:href="@{${closeLink}}"><img src="./assets/images/close.svg" alt=""></a>
        </button>
    </div>
    <!-- Left Panel End -->
</div>
<script src="./assets/lib/jquery-3.6.0.min.js"></script>
<script src="./assets/js/script.js?ver=1.1"></script>

<script>
    window.onload = function() {
        aaa();

    }
</script>

<script>
    function reload(){
        location.reload();
    }
</script>

<script>
var vdo_play = "";

function aaa() {
    console.log('aaaaaa');
    if (vdo_play) {
        clearInterval(vdo_play);
    }
    var iframe = document.querySelector('iframe');
    var player = new Vimeo.Player(iframe);


           window.addEventListener("beforeunload", function (e) {
        console.log('beforeunload');
        console.log($(e.target).attr('id'));
        console.log(e);
        var confirmationMessage = "\o/";

        const rawResponse = fetch('/video?eventType=LEAVE&position=' + currentPos,
            {
                method: 'POST',
            }
        );
    });

    player.on('pause', function(getAll) {

        currentPos = getAll.seconds;

        const rawResponse = fetch('/video?eventType=PAUSE&position=' + currentPos, {
            method: 'POST',
        });

        console.log('pause');
    });

    player.on('play', function(getAll) {

        currentPos = getAll.seconds;

        const rawResponse = fetch('/video?eventType=PLAY&position=' + currentPos, {
            method: 'POST',
        });

        console.log('play');
    });

    player.on('ended', function() {
       clearInterval(vdo_play);
       enableButton();
    });

    player.on('seeked', function(getAll) {
       console.log('rewind');
       currentPos = getAll.seconds;

       const rawResponse = fetch('/video?eventType=REWIND&position=' + currentPos, {
            method: 'POST',
        });

       console.log(currentPos);
    });

        player.on('timeupdate', function(getAll) {
            currentPos = getAll.seconds; //get currentime
            vdoEndTym = getAll.duration; //get video duration
            percentage = (getAll.percent * 100) + "%";

            console.log('currentPos')
            console.log(currentPos)

            if (percentage == '100%') {
                console.log('100000000000000000000%');
                enableButton();
            }
        });


    var currentPos, percentage, vdoEndTym = "";
    vdo_play = setInterval(function() {
<!--        player.on('timeupdate', function(getAll) {-->
<!--            currentPos = getAll.seconds; //get currentime-->
<!--            vdoEndTym = getAll.duration; //get video duration-->
<!--            percentage = (getAll.percent * 100) + "%";-->

<!--            if (percentage == '100%') {-->
<!--                console.log('100000000000000000000%');-->
<!--                enableButton();-->
<!--            }-->
<!--        });-->

    }, 1000);
};

</script>
<script>
    function enableButton(){
        document.getElementById('dis-button').removeAttribute("disabled");
        document.getElementById('dis-button').classList.remove("disabled-button");
    }

</script>
<script>
    let intervalId = window.setInterval(function(){
        fetch('/video/session/expired', {
            method: 'GET',
        })
        .then(
            function(response) {
                response.json().then(function(data) {
                    console.log(data);
                    if (data == true) {
                        document.getElementById('video').setAttribute('hidden', 'hidden')
                        document.getElementById('expired').removeAttribute('hidden')
                        window.clearInterval(intervalId);
                    }
                })
            }
        );
    }, 2000);

</script>
</body>
</html>